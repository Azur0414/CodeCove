<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.member.mapper.LoginMapper">

<resultMap type="memberVO" id="loginMap">
		<result property="memId" column="MEM_ID" /> 
		<result property="memPass" column="MEM_PASS" /> 
		<result property="memName" column="MEM_NAME" /> 
		<result property="memNick" column="MEM_NICK" /> 
		<result property="memMail" column="MEM_MAIL" /> 
		<result property="memHP" column="MEM_HP" /> 
		<result property="report" column="REPORT" />
		<result property="memProfile" column="MEM_PROFILE" />
		<collection property="roleList" resultMap="memberRoleMap"></collection> 
	</resultMap>
	<resultMap type="memberRole" id="memberRoleMap">
		<result property="memId" column="MEM_ID" />
		<result property="roleCode" column="ROLE_CODE" />
	</resultMap>
	
	<select id="loginCheck" parameterType="memberVO" resultMap="loginMap">
		SELECT A.MEM_ID, A.MEM_PASS, A.MEM_NAME, A.MEM_NICK, A.MEM_MAIL, A.MEM_HP, A.REPORT, A.MEM_PROFILE
		     , B.MEM_ID, B.ROLE_CODE
		FROM TB_MEMBER A LEFT OUTER JOIN TB_ROLE_ASSIGNMENT B
		ON(A.MEM_ID = B.MEM_ID)
		WHERE  A.MEM_ID = #{memId}
	</select>
	
	<select id="idCheck" parameterType="string" resultType="memberVO">
		select 
			MEM_ID, MEM_PASS, MEM_NAME, MEM_NICK, MEM_MAIL, MEM_HP, REPORT, MEM_PROFILE
		from TB_MEMBER
		where mem_id = #{memId}
	</select>
	
	<insert id="signup" parameterType="memberVO">
		insert into TB_MEMBER(
			MEM_ID, MEM_PASS, MEM_NAME, MEM_NICK, MEM_MAIL, MEM_HP, REPORT, MEM_PROFILE
		) values (
			#{memId}, #{memPass}, #{memName}, #{memNick}, #{memMail}, #{memHP}, -1, #{memProfile}
		)
	</insert>
	
	<insert id="signupRole" parameterType="memberRole">
		insert into TB_ROLE_ASSIGNMENT(
			MEM_ID, ROLE_CODE
		) values (
			#{memId}, #{roleCode}
		)
	</insert>
	
	<select id="idForgetProcess" parameterType="memberVO" resultType="string">
		select mem_id from TB_MEMBER
		where mem_mail = #{memMail}
		and mem_name = #{memName}
	</select>
	
	<select id="pwForgetProcess" parameterType="memberVO" resultType="string">
		select mem_pw from TB_MEMBER
		where mem_id = #{memId} 
		and mem_mail = #{memMail}
		and mem_name = #{memName}
	</select>
	
</mapper>