package kr.or.ddit.member.controller;

import java.util.List;

import javax.inject.Inject;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import kr.or.ddit.common.AttatchVO;
import kr.or.ddit.expert.vo.MyExpertVO;
import kr.or.ddit.member.service.IMemberService;
import kr.or.ddit.member.service.IMypageService;
import kr.or.ddit.member.vo.ExpertVO;
import kr.or.ddit.member.vo.MemberVO;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Controller
@RequestMapping("/coco") 
public class MentorController {

	@Inject
	private IMypageService mypageService;
	
	@Inject
	private IMemberService memberService;

	
	@RequestMapping(value = "/applyMentor", method = RequestMethod.GET)
	public String applyMentorForm(HttpServletRequest req, Model model, RedirectAttributes ra) {

		HttpSession session = req.getSession();
		MemberVO sessionMember = (MemberVO) session.getAttribute("SessionInfo");
		
		
		if (sessionMember == null) {
			ra.addFlashAttribute("message", "로그인 후 이용가능합니다!");
			return "redirect:/coco/login";
		}
		
		String memId = sessionMember.getMemId();
		
		// 회원 상태 확인
		
		model.addAttribute("memId", memId);

		return "member/applyMentor";
	}
	
	
	
	@RequestMapping(value = "/insertMentor", method = RequestMethod.POST)
	public String applyMentorInsert(HttpServletRequest req, ExpertVO expertVO, Model model) {
//		String goPage = "";

		
		System.out.println("파일 확인 >> " + expertVO.getPostFiles());
		List<AttatchVO> attatchList = expertVO.getAttatchList();
		log.info("mypost:{}", expertVO);
		log.info("attatchList:{}", attatchList);
		
		
		int result = mypageService.mentorInsert(expertVO);
		
		

		return "member/applyMentor";
	}
	

	
	@RequestMapping(value = "/mentorList", method = RequestMethod.GET)
	public String mentorListForm(HttpServletRequest req, Model model, RedirectAttributes ra) {
		
		HttpSession session = req.getSession();
		MemberVO sessionMember = (MemberVO) session.getAttribute("SessionInfo");
		
		if (sessionMember == null) {
			ra.addFlashAttribute("message", "로그인 후 이용가능합니다!");
			return "redirect:/coco/login";
		}

		MemberVO member = memberService.selectMember(sessionMember);
		
		List<ExpertVO> myexpertList = mypageService.totalList(member);
		
		model.addAttribute("list", myexpertList);
		
		// 멘토신청내역이 N인 사람에게만 신청하기 버튼이 보임.
		if(member.getMemexpYn().equals("N")) {
			model.addAttribute("status", "g");
		}

		return "member/mentorList";
		
	}
	
}
